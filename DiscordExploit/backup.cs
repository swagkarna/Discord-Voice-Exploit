using Discord.Gateway;
using Discord.Voice;
using System;
using System.Threading;


namespace DiscordExploit
{
    class Program
    {
        static void Main()
        {
            DiscordSocketClient client = new DiscordSocketClient();
            Console.Clear();
            client.OnLoggedIn += client_OnLoggedIn;
            client.Login("NjkxOTA5MjMyNDMzMjk5NDk2.X1NuHQ.9rf1KiIW8EmR0l47CjbCiOQPUTw");
            Thread.Sleep(-1);
        }

        private static void client_OnLoggedIn(DiscordSocketClient client, LoginEventArgs args)
        {
            // if you want to connect to a private channel that hasn't started a call yet, do this before connecting
            // client.StartCall(1337);

            // join a voice channel with the following parameters:
            // our channel's guild ID (set to null if it's a private channel)
            // the channel's own ID
            // we don't want to mute ourselves
            // we want to deafen ourselves

            Console.Clear();

            ulong guildId = 0;
            ulong channelId = 0;

            Console.Write("Guild ID: ");
            guildId = Convert.ToUInt64(Console.ReadLine());

            Console.WriteLine(string.Empty);

            Console.Write("Channel ID: ");
            channelId = Convert.ToUInt64(Console.ReadLine());

            DiscordVoiceSession session = client.JoinVoiceChannel(guildId, channelId, true, true);
            session.OnConnected += session_OnConnected;
        }
        private static void session_OnConnected(DiscordVoiceSession session, EventArgs e)
        {
            Console.Clear();
            Console.WriteLine("Connected!");

            // create a stream to send voice data through with 64kbps audio optimized for music
            DiscordVoiceStream stream = session.CreateStream(64000, AudioApplication.Music);

            // Anarchy has this helper method for using FFmpeg to extract audio from a file
            byte[] song = DiscordVoiceUtils.ReadFromFile(@"C:\Users\Manono\Downloads\jw.mp3");

            // this method writes the entire byte[] to the stream. read the docs for more info
            stream.CopyFrom(song); // your file's path could also be passed here to read it.

            // atm you have to tell discord that you're not sending data anymore yourself
            session.SetSpeaking(false);
        }

        //private static void client_OnLoggedIn(DiscordSocketClient nig, LoginEventArgs args)
        //{
        //    Console.WriteLine("Logged in");
        //
        //    var session = nig.JoinVoiceChannel(751254301695017130, 751259166076698626);
        //    session.OnConnected += (s, a) =>
        //    {
        //
        //        DiscordVoiceStream stream = session.CreateStream(64000, AudioApplication.Music);
        //        byte[] song = DiscordVoiceUtils.ReadFromFile(@"C:\Users\Manono\Downloads\Moan_11.wav");
        //        stream.CopyFrom(song);
        //        session.SetSpeaking(false);
        //        Console.WriteLine("Speaking");
        //    };
        //}
    }
}